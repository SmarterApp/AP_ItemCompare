package org.opentestsystem.ap.itemcompare.comparer.html.comparison;

import org.opentestsystem.ap.common.saaif.item.ItemRelease;
import org.springframework.stereotype.Component;

import static org.apache.commons.lang3.StringUtils.isBlank;
import static org.apache.commons.lang3.StringUtils.trimToNull;

/**
 * This comparison provider returns general html fragments common
 * across multiple item types.
 */
@Component
class GeneralItemTypeHtmlComparisonProvider implements ItemTypeHtmlComparisonProvider {

    @Override
    public void appendComparisons(final ItemTypeHtmlComparisonContext context,
                                  final ItemRelease.Item.Content sourceContent,
                                  final ItemRelease.Item.Content testContent) {
        appendStem(context, sourceContent, testContent);
    }

    private void appendStem(final ItemTypeHtmlComparisonContext context,
                            final ItemRelease.Item.Content sourceContent,
                            final ItemRelease.Item.Content testContent) {
        final String sourceStem = sourceContent == null ? null : trimToNull(sourceContent.getStem());
        final String testStem = testContent == null ? null : trimToNull(testContent.getStem());
        if (isBlank(sourceStem) && isBlank(testStem)) return;

        context.getComparisons().add(HtmlComparison.builder()
            .location(context.getLanguage() + " Prompt")
            .sourceHtml(sourceStem)
            .testHtml(testStem)
            .build());
    }
}
