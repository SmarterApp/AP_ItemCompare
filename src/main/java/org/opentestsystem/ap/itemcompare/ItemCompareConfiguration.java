package org.opentestsystem.ap.itemcompare;

import lombok.extern.slf4j.Slf4j;
import org.opentestsystem.ap.common.config.ItemBankProperties;
import org.opentestsystem.ap.common.datastore.DataStoreDataManager;
import org.opentestsystem.ap.itemcompare.util.GitLabApiClient;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.context.annotation.Bean;

@Slf4j
@org.springframework.context.annotation.Configuration
@ConditionalOnProperty(value = "itembank.test.enabled", havingValue = "false", matchIfMissing = true)
public class ItemCompareConfiguration {

    private final ApplicationProperties applicationProperties;

    public ItemCompareConfiguration(ApplicationProperties applicationProperties,
                                    ItemBankProperties itemBankProperties) {
        this.applicationProperties = applicationProperties;
    }

    @Bean
    public GitLabApiClient gitLabApiClient(RestTemplateBuilder restTemplateBuilder) {
        return new GitLabApiClient(this.applicationProperties, restTemplateBuilder);
    }

    // Defined bean with null parameters to avoid startup exception.
    // DataStoreDataManager is not used in ap-item-compare
    @Bean
    public DataStoreDataManager dataStoreDataManager() {
        return new DataStoreDataManager(null,
                null,null,
                null, null);
    }
}
