package org.opentestsystem.ap.itemcompare.service;

import com.google.common.base.Charsets;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.mockito.runners.MockitoJUnitRunner;

import java.io.File;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.stream.Collectors;

import static org.assertj.core.api.Assertions.assertThat;

@RunWith(MockitoJUnitRunner.class)
public class DefaultTemporaryDirectoryProviderTest {

    @InjectMocks
    private DefaultTemporaryDirectoryProvider provider;

    @Test
    public void itShouldCreateTemporaryDirectories() throws Exception {
        final Path tempA = provider.createTempDir("prefix-a");
        assertThat(Files.list(tempA).collect(Collectors.toList())).isEmpty();

        final Path fileA = tempA.resolve("file-a.txt");
        Files.write(fileA, "Test Bytes".getBytes(Charsets.UTF_8));

        try {
            assertThat(Files.list(tempA)
                .map(Path::toFile)
                .map(File::getName)
                .collect(Collectors.toList())).containsOnly("file-a.txt");

            final Path tempB = provider.createTempDir("prefix-a");
            assertThat(Files.list(tempB).collect(Collectors.toList())).isEmpty();
        } finally {
            Files.delete(fileA);
        }
    }
}